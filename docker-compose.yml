version: '3.9'

services:
  # ===============================
  # ğŸŸ¢ å‰ç«¯ï¼šVue (Vite)
  # ===============================
  frontend:
    build:
      context: .
      dockerfile: Dockerfile.frontend
    container_name: furfriends_frontend
    ports:
      - "5173:5173"
    volumes:
      - ./src:/app/src                # âœ… è‡ªå‹•åŒæ­¥å‰ç«¯ç¨‹å¼
      - ./public:/app/public          # âœ… åŒæ­¥ public éœæ…‹æª”æ¡ˆ
      - /app/node_modules             # é¿å…è¦†è“‹å®¹å™¨å…§çš„ node_modules
    depends_on:
      - backend
    restart: always

  # ===============================
  # ğŸŸ  å¾Œç«¯ï¼šNode.js + Express + Mongoose
  # ===============================
  backend:
    build:
      context: .
      dockerfile: Dockerfile.backend
    container_name: furfriends_backend
    ports:
      - "3000:3000"
    volumes:
      - ./backend:/app                # âœ… è‡ªå‹•åŒæ­¥ backend è³‡æ–™å¤¾
      - /app/node_modules
    environment:
      - PORT=3000
      - MONGODB_URI=mongodb://mongo:27017/furfriends   # â­ é€£æ¥ Docker å…§çš„ MongoDB
    depends_on:
      - mongo
    restart: always

  # ===============================
  # âš« MongoDB è³‡æ–™åº«
  # ===============================
  mongo:
    image: mongo:7
    container_name: furfriends_mongo
    ports:
      - "27017:27017"
    volumes:
      - mongo_data:/data/db           # âœ… æ°¸ä¹…ä¿å­˜è³‡æ–™
    restart: always

# ===============================
# ğŸ—‚ Volume å€åŸŸï¼šä¿å­˜ MongoDB è³‡æ–™
# ===============================
volumes:
  mongo_data:
